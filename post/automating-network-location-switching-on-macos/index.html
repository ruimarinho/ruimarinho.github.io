<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.69.0"><title>Automating network location switching on macOS - Rui Marinho</title><meta property="og:title" content="Automating network location switching on macOS - Rui Marinho"><link rel=icon href=https://ruimarinho.github.io/images/ type=image/x-icon><link rel=stylesheet href=https://ruimarinho.github.io/css/main.css media=all><link rel=stylesheet href="//fonts.googleapis.com/css?family=Merriweather:400|Lato:400,400italic,700"><link rel=stylesheet href=https://ruimarinho.github.io/css/pre.css media=all></head><body><div class=wrapper><header class=header><nav class=nav><a href=https://ruimarinho.github.io/ class=nav-logo><img src=https://ruimarinho.github.io/images/profile.jpg width=50 height=50 alt="Rui's Profile Picture"></a><ul class=nav-links><li><a href=https://ruimarinho.github.io/about/>about</a></li><li><a href=https://github.com/ruimarinho>github</a></li><li><a href=https://ruimarinho.github.io/>posts</a></li><li><a href=https://twitter.com/ruipmarinho>twitter</a></li></ul></nav></header><main class=content role=main><article class=article><span class=article-duration>2 min read</span><h1 class=article-title>Automating network location switching on macOS</h1><span class=article-date>May 29, 2017</span><div class=article-content><p>macOS has offered <a href=https://support.apple.com/en-us/HT202480>network locations on the Mac</a> ever since OS X v10.6. By default, the <em>Automatic</em> location is selected on all Macs but it&rsquo;s not that intuitive what it really means. In fact, unlike what the name suggests, it&rsquo;s just a setting that makes your Mac search for a network or internet connection on all network interfaces available.</p><p></p><p>On a future macOS update, I wish the location feature is connected to the actual geolocation of the Mac so that changing physical locations allows me to trigger specific automations.</p><p>Until that happens, we can rely on an old but clever hack to achieve just that. With the ubiquity of wireless network connections, it&rsquo;s likely that a certain SSID matches a physical location, so by watching <code>com.apple.airport.preferences.plist</code> for wireless network settings updates such as the last timestamp your Mac has connected to a specific network, you can easily query <code>airport</code> to know which wireless network you&rsquo;ve just connected to, allowing you to react to such event.</p><pre><code>‚ùØ /System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -I
           SSID: foobar
</code></pre><p><a href=https://github.com/eprev/locationchanger>locationchanger</a> wraps this neat trick into a small shell tool that tells macOS to automatically switch the network location when connected to a specific wireless network (<em>side note: make sure you don&rsquo;t blindly trust <a href=https://github.com/eprev/locationchanger#installation--update>the root pipe to shell</a></em>). You might want to use specific DNS resolvers, set proxies or define different IP leases between your home and work networks. In order to get this to work, you only need to create a network location with the name of the wireless network you want it to activate with. So, if your wireless network is called <strong>Acme Inc</strong>, you should name your network location like that and define your preferred settings. If you don&rsquo;t specify any other locations, it will default to <strong>Automatic</strong> when connecting to any other network.</p><p>Another powerful feature of <code>locationchanger</code> is to execute scripts whenever a location change is detected. This is great if you want, for instance, to switch your work VPN on and off. I&rsquo;m a long time fan of <a href="https://www.sparklabs.com/viscosity/?utm_source=ruimarinho&utm_medium=blog-post&utm_campaign=automating-network-location-switching-on-macos">Viscosity</a>, so this is what I use:</p><p>Under <code>~/.locations/Automatic</code>:</p><pre><code>osascript -e 'tell application &quot;Viscosity&quot; to disconnect &quot;Work&quot;'
</code></pre><p>and under <code>~/.locations/Acme Inc</code>:</p><pre><code>osascript -e 'tell application &quot;Viscosity&quot; to connect &quot;Work&quot;'
</code></pre><p>Other interesting use cases could be adjusting sleep settings, enabling or disabling USB ports, executing a web request to update your Slack status and much more!</p></div></article></main><footer class=footer><ul class=footer-links><li><a href=https://ruimarinho.github.io/index.xml type=application/rss+xml target=_blank>RSS feed</a></li></ul></footer></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-90727541-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>