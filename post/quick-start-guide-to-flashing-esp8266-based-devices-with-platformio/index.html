<!doctype html><html lang=en><head><title>Quick start guide to flashing ESP8266-based devices with PlatformIO ::
Memory Leak — Rui Marinho</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="If you&amp;rsquo;re into IoT, you&amp;rsquo;ve probably heard of PlatformIO - an integrated development environment for IoT similar to the Arduino IDE.
A lot of the IoT devices run on the low-cost ESP8266 chip. It can be found on a range of applications, from power meters to switches, sensors and even LED controllers. They are very popular in the DIY community but also commercially available in the form of ready-to-use products and development kits from several manufacturers, such as IteadStudio, makers of the Sonoff product line, Wemos, known for its D1 Mini and MagicHome LED Controllers, to name a few."><meta name=keywords content="blog technology automation devops network security"><meta name=robots content="noodp"><link rel=canonical href=https://memoryleak.dev/post/quick-start-guide-to-flashing-esp8266-based-devices-with-platformio/><link rel=stylesheet href=https://memoryleak.dev/assets/style.css><link rel=stylesheet href=https://memoryleak.dev/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://memoryleak.dev/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://memoryleak.dev/img/favicon.png><link href=https://memoryleak.dev/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://memoryleak.dev/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://memoryleak.dev/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://memoryleak.dev/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://memoryleak.dev/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://memoryleak.dev/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="Quick start guide to flashing ESP8266-based devices with PlatformIO"><meta name=twitter:description content="If you&rsquo;re into IoT, you&rsquo;ve probably heard of PlatformIO - an integrated development environment for IoT similar to the Arduino IDE.
A lot of the IoT devices run on the low-cost ESP8266 chip. It can be found on a range of applications, from power meters to switches, sensors and even LED controllers. They are very popular in the DIY community but also commercially available in the form of ready-to-use products and development kits from several manufacturers, such as IteadStudio, makers of the Sonoff product line, Wemos, known for its D1 Mini and MagicHome LED Controllers, to name a few."><meta property="og:title" content="Quick start guide to flashing ESP8266-based devices with PlatformIO"><meta property="og:description" content="If you&rsquo;re into IoT, you&rsquo;ve probably heard of PlatformIO - an integrated development environment for IoT similar to the Arduino IDE.
A lot of the IoT devices run on the low-cost ESP8266 chip. It can be found on a range of applications, from power meters to switches, sensors and even LED controllers. They are very popular in the DIY community but also commercially available in the form of ready-to-use products and development kits from several manufacturers, such as IteadStudio, makers of the Sonoff product line, Wemos, known for its D1 Mini and MagicHome LED Controllers, to name a few."><meta property="og:type" content="article"><meta property="og:url" content="https://memoryleak.dev/post/quick-start-guide-to-flashing-esp8266-based-devices-with-platformio/"><meta property="article:published_time" content="2018-01-13T11:47:00+00:00"><meta property="article:modified_time" content="2018-01-13T11:47:00+00:00"><meta property="og:site_name" content="Memory Leak"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=https://memoryleak.dev/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>memory leak</span>
<span class=logo__cursor></span></a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=https://memoryleak.dev/about/>About</a></li><li><a href=https://memoryleak.dev/>Blog</a></li><li><a href=https://github.com/ruimarinho>GitHub</a></li><li><a href=https://twitter.com/ruipmarinho>Twitter</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=https://memoryleak.dev/about/>About</a></li><li><a href=https://memoryleak.dev/>Blog</a></li><li><a href=https://github.com/ruimarinho>GitHub</a></li><li><a href=https://twitter.com/ruipmarinho>Twitter</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>Quick start guide to flashing ESP8266-based devices with PlatformIO</h1><div class=post-meta><span class=post-date>2018-01-13</span></div><div class=post-content><p>If you&rsquo;re into IoT, you&rsquo;ve probably heard of <a href=http://platformio.org/get-started>PlatformIO</a> - an integrated development environment for IoT similar to the Arduino IDE.</p><p>A lot of the IoT devices run on the low-cost ESP8266 chip. It can be found on a range of applications, from power meters to switches, sensors and even LED controllers. They are very popular in the DIY community but also commercially available in the form of ready-to-use products and development kits from several manufacturers, such as <a href=https://www.itead.cc>IteadStudio</a>, makers of the Sonoff product line, <a href=https://www.wemos.cc>Wemos</a>, known for its D1 Mini and <a href="https://www.aliexpress.com/item/16Million-colors-Wifi-RGB-RGBW-led-controller-smartphone-control-music-and-timer-mode-magic-home-wifi/32755262961.html?aff_platform=product&cpt=1514663542338&sk=VNnYVjE&aff_trace_key=28ac08e8485f4982bf4c3f386a3361b8-1514663542338-08826-VNnYVjE&terminal_id=c4865e9dca1640d9882c807e0632af1b">MagicHome LED Controllers</a>, to name a few.</p><p>The original firmware that these devices come with, besides being proprietary, hasn&rsquo;t been satisfactory for most IoT tinkerers. They lack support for other sensors and also miss controls and features one would like when connecting them too home automation systems, such as support for MQTT, REST APIs, Over-The-Air (OTA) updates and so much more.</p><p>Three widely popular open-source ESP8266 firmware alternatives with a focus on Sonoff products (but not exclusive to) are <a href=https://bitbucket.org/xoseperez/espurna/overview>ESPurna</a>, <a href=https://github.com/arendst/Sonoff-Tasmota>Sonoff-Tasmota</a> and <a href=https://github.com/letscontrolit/ESPEasy>ESPeasy</a>. Besides using PlatformIO, they all have in common a passionate community which dedicate a lot of their time adding support for new sensors and features. Their documentation is also really good.</p><p>If you would like to try any of these firmwares, you will need to flash your device using a USB-to-UART programmer. You can get acquainted about which pins to connect to by reading <a href=https://bitbucket.org/xoseperez/espurna/wiki/Hardware>ESPurna&rsquo;s Wiki</a>.</p><p>After connecting your device, install <code>platformio</code> using Homebrew:</p><pre><code>❯ brew install platformio
</code></pre><p>Clone the ESPurna repo and checkout the most recent tag:</p><pre><code>❯ git clone https://bitbucket.org/xoseperez/espurna.git
❯ git checkout $(git describe --tags)
❯ cd code
</code></pre><p>ESPurna comes with preconfigured device environments as listed under <code>platformio.ini</code>. It also offers some variants such as <code>dht</code> which bundle support for specific sensors (in this case, temperature and humidity).</p><p>For the first firmware flash, the regular variant should be used. Take the case of a Sonoff Basic.</p><p>Connect your device to your computer, put it in flash mode and run the <code>pio</code> command. It will download all dependencies, compile them, automatically detect the USB-to-UART programmer and upload the binary image to the device.</p><pre><code>❯ pio run -t upload -e itead-sonoff-basic
</code></pre><p>The procedure is very simple and takes about a minute to complete.</p><h3 id=over-the-air-ota-updates>Over-The-Air (OTA) Updates</h3><p>Most of these firmwares offer some kind of OTA update. Some <a href=https://www.letscontrolit.com/wiki/index.php/ESP_Easy_web_interface#Tools_Firmware_update_using_OTA>require uploading a binary image directly through their HTTP interface</a> while others <a href=https://github.com/arendst/Sonoff-Tasmota/wiki/Upgrade>bundle built-in functionality for remote downloading firmware images</a> which is pretty cool for automating updates.</p><p>ESPurna does it a little bit different by offering a special OTA environment for each device. For instance, if you would like to update your Sonoff Basic after flashing ESPurna once, then you could just do:</p><pre><code>❯ pio run -t upload -e itead-sonoff-basic-ota
</code></pre><p>This, of course, assumes that you left all configurations values to their defaults - that is IP and authentication password. Since hopefully that isn&rsquo;t the case, then there is a generic OTA environment which reads environment variables from your shell. This way you can dynamically configure your device information without having to change values directly on the <code>platformio.ini</code> file.</p><p>Export the shell variables:</p><pre><code>❯ export ESPURNA_BOARD=&quot;ITEAD_SONOFF_BASIC&quot;
❯ export ESPURNA_IP=&quot;192.168.10.1&quot;
❯ export ESPURNA_AUTH=&quot;foobar&quot;
</code></pre><p>Then run <code>pio</code> using the generic environment:</p><pre><code>❯ pio run -t upload -e esp8266-1m-ota
</code></pre><p>On a last note, if you&rsquo;re not into flashing through serial mode (required for the first flash), there is a new and exciting project that attempts to flash the Tasmota firmware using the original OTA mechanism of the Sonoff via WiFi - <a href=https://github.com/mirko/SonOTA>SonOTA</a>. Something to explore in the future!</p></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"memoryleak-ruimarinho"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user">Rui Marinho</div></div></footer><script src=https://memoryleak.dev/assets/main.js></script><script src=https://memoryleak.dev/assets/prism.js></script></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-90727541-1','auto');ga('send','pageview');}</script></body></html>